{
  "name": "agent",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "seconds",
              "secondsInterval": 10
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        0,
        0
      ],
      "id": "a77042d7-f2da-463c-8180-57d7950dbacc",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "You are a personal holiday planner assistant.\n\nYour role is to automatically plan small getaways for the user based on upcoming holidays and current weather conditions.\n\n=== Task ===\n1. Access the user's Google Calendar and search for events that contain the word \"Holiday\" (case-insensitive) in:\n   - The event **title**, or\n   - The event **description**\n\n2. From the list of matching events, **identify the nearest future holiday** (i.e., the one closest to today that has not yet occurred).\n\n3. Extract the following from the selected holiday event:\n   - Holiday name (if available)\n   - Date of the holiday\n   - Day of the week\n\n4. Use OpenWeatherMap to **fetch the weather forecast** for **Gurgaon or nearby destination area** for the holiday date. Prioritize weather parameters such as:\n   - General weather condition (clear, partly cloudy, sunny)\n   - Avoid suggesting destinations if rain, thunderstorm, or extreme weather is forecast\n\n5. Read the destination list from Google Sheets. Each destination includes:\n   - Name\n   - Distance (in km)\n   - Travel Time (in minutes or hours)\n   - Type (e.g., nature, historic, leisure)\n   - Ideal Duration (e.g., half-day, full-day)\n\n6. From the list, choose a **single destination** that:\n   - Is within **35 km of Gurgaon**\n   - Matches the weather condition (e.g., avoid outdoor nature trips if bad weather)\n   - Fits the estimated available time (e.g., full-day trips for long holidays)\n   - Has not been recommended already for that date (use memory if needed)\n\n7. Compose a friendly and engaging **travel suggestion message** that feels personalized to the user.\n\n8. Send this message as an email using Gmail. Format it neatly, include emojis and headings for readability.\n\n9. (Optional) Create an event in Google Calendar for the suggested trip, so it appears on the user‚Äôs calendar.\n\n=== Input ===\n- Google Calendar events (to detect holidays)\n- Google Sheets (destination data)\n- OpenWeatherMap forecast (for the holiday date)\n- User‚Äôs email address\n- Optional: User preferences like preferred destination type\n\n=== Tools You Can Use ===\n- Google Calendar: To get upcoming events and find the next holiday\n- Google Sheets: To read destination information\n- OpenWeatherMap: To fetch the weather forecast for the holiday\n- Gmail: To send the email containing the trip plan\n- Google Calendar: To create a travel event (optional)\n- OpenAI: To generate a personalized travel suggestion message\n- Memory: To avoid repeating the same destination for the same holiday\n\n=== Constraints ===\n- Only one holiday should be processed at a time: the **nearest future holiday**\n- Only suggest destinations if the weather is appropriate (no rain/storms)\n- Avoid recommending the same destination for the same holiday\n- Ensure the distance is within **35 km** of Gurgaon\n- The recommendation should match the **duration** of the holiday (half-day/full-day)\n- Avoid sending multiple emails for the same holiday\n- Handle missing or ambiguous data gracefully (e.g., fallback to defaults if no ideal match is found)\n\n=== Output Format (Email Body) ===\n\nSubject: üåû Perfect Holiday Plan for {{holiday_date}}!\n\nHi {{user_name}},\n\nüéâ You‚Äôve got a holiday on **{{holiday_date}}** ({{day_of_week}}), and we‚Äôve planned something great for you!\n\nüèû **Destination:** {{destination_name}}  \nüìç **Distance:** {{distance}} from Gurgaon  \n‚è± **Travel Time:** {{travel_time}}  \nüå§ **Weather Forecast:** {{weather_description}}  \nüïí **Ideal Trip Duration:** {{trip_duration}}  \nüéí **Type:** {{destination_type}}\n\n‚ú® Your calendar has also been updated with this plan. Have a refreshing break!\n\n‚Äî Your Holiday Planner Agent\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.1,
      "position": [
        208,
        0
      ],
      "id": "481ae743-5406-46f0-a497-071366b8ecba",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "=test1"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        224,
        256
      ],
      "id": "7d49f692-78d0-459a-9bcb-8757a78bc466",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "laughingduck0208@gmail.com",
          "mode": "list",
          "cachedResultName": "laughingduck0208@gmail.com"
        },
        "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
        "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
        "useDefaultReminders": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Use_Default_Reminders', ``, 'boolean') }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        368,
        256
      ],
      "id": "cf08f22d-70d8-44b0-82b2-1f91e115e100",
      "name": "Create an event in Google Calendar",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "y2UdsLkOtJ3uWzSz",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "format": "imperial",
        "cityName": "Gurgaon, IN"
      },
      "type": "n8n-nodes-base.openWeatherMapTool",
      "typeVersion": 1,
      "position": [
        512,
        256
      ],
      "id": "407577ab-dc30-4401-972d-a124fe1b66c4",
      "name": "OpenWeatherMap",
      "credentials": {
        "openWeatherMapApi": {
          "id": "GawyynUHstbRm6Yx",
          "name": "OpenWeatherMap account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1Nx1mbi1qQe5tPhUiVAbl_-E2Tyn9vraun6lyq3QpZFs",
          "mode": "list",
          "cachedResultName": "Trip",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Nx1mbi1qQe5tPhUiVAbl_-E2Tyn9vraun6lyq3QpZFs/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Nx1mbi1qQe5tPhUiVAbl_-E2Tyn9vraun6lyq3QpZFs/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.6,
      "position": [
        656,
        256
      ],
      "id": "7497838b-74fa-4a16-a6d3-21a478f40d19",
      "name": "Get row(s) in sheet in Google Sheets",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "gGqaLuDoisT5XrEi",
          "name": "Google Sheets account 4"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "laughingduck0208@gmail.com",
        "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}",
        "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmailTool",
      "typeVersion": 2.1,
      "position": [
        816,
        256
      ],
      "id": "17bfc1d7-9dbf-404a-95f7-c6117721b478",
      "name": "Send a message in Gmail",
      "webhookId": "429248b9-8da2-42d1-98d9-f431ace687e8",
      "credentials": {
        "gmailOAuth2": {
          "id": "KVPyoePYvHBF6a3L",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-pro",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        64,
        256
      ],
      "id": "5cdbf630-940d-4017-b78a-5a49992371eb",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "vbLoh94RR0UkwzZd",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet in Google Sheets": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenWeatherMap": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Create an event in Google Calendar": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Send a message in Gmail": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "ae79c1d8-9ffd-4924-9b61-8c9c87c32d4f",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "ea6dc836122d4c626af192156666bcab69fb36b1aae425c211af4b9cb18ff53b"
  },
  "id": "SSLajBtBrMtO71BH",
  "tags": []
}